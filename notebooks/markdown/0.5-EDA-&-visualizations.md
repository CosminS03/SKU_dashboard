```python
import pandas as pd

df = pd.read_csv("../data/interim/online_retail_no_outliers.csv", dtype = {"InvoiceNo": str})
```


```python
df["Revenue"] = round(df["Quantity"] * df["UnitPrice"], 2)
```


```python
gross_profit = df.groupby(by="SKU")["Revenue"].sum().reset_index()

total_rev = df[~df["InvoiceNo"].str.startswith('C')].groupby(by="SKU")["Revenue"].sum().reset_index()

gross_profit = gross_profit.rename(columns={"Revenue": "Gross_Profit"})

total_rev = total_rev.rename(columns={"Revenue": "Total_Revenue"})
```


```python
gross_margin = pd.merge(gross_profit, total_rev, on="SKU", how = "outer")
gross_margin = gross_margin.fillna(0)
```


```python
import numpy as np

gross_margin["Margin"] = round((gross_margin["Gross_Profit"] / gross_margin["Total_Revenue"]) * 100, 2)

gross_margin["Margin"] = gross_margin["Margin"].replace([np.inf, -np.inf], 0)
```


```python
gross_margin[(gross_margin["Margin"] != 100) & (gross_margin["Margin"] > 0)].sort_values(
    by="Margin", ascending=False).tail(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SKU</th>
      <th>Gross_Profit</th>
      <th>Total_Revenue</th>
      <th>Margin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1111</th>
      <td>79164</td>
      <td>105.33</td>
      <td>110.28</td>
      <td>95.51</td>
    </tr>
    <tr>
      <th>174</th>
      <td>21066</td>
      <td>289.60</td>
      <td>304.60</td>
      <td>95.08</td>
    </tr>
    <tr>
      <th>200</th>
      <td>21129</td>
      <td>256.10</td>
      <td>270.00</td>
      <td>94.85</td>
    </tr>
    <tr>
      <th>252</th>
      <td>21284</td>
      <td>296.86</td>
      <td>317.14</td>
      <td>93.61</td>
    </tr>
    <tr>
      <th>598</th>
      <td>22394</td>
      <td>174.58</td>
      <td>189.88</td>
      <td>91.94</td>
    </tr>
    <tr>
      <th>98</th>
      <td>20798</td>
      <td>69.00</td>
      <td>75.60</td>
      <td>91.27</td>
    </tr>
    <tr>
      <th>203</th>
      <td>21144</td>
      <td>12.24</td>
      <td>16.80</td>
      <td>72.86</td>
    </tr>
    <tr>
      <th>270</th>
      <td>21349</td>
      <td>60.75</td>
      <td>87.75</td>
      <td>69.23</td>
    </tr>
    <tr>
      <th>416</th>
      <td>21777</td>
      <td>55.65</td>
      <td>95.40</td>
      <td>58.33</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>85047</td>
      <td>0.80</td>
      <td>19.05</td>
      <td>4.20</td>
    </tr>
  </tbody>
</table>
</div>




```python
from src import plots

plots.revenue_breakdown(df)
```


    
![png](0.5-EDA-%26-visualizations_files/0.5-EDA-%26-visualizations_6_0.png)
    

